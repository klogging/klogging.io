"use strict";(self.webpackChunkklogging=self.webpackChunkklogging||[]).push([[748],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},g={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(t),m=i,f=p["".concat(s,".").concat(m)]||p[m]||g[m]||r;return t?o.createElement(f,a(a({ref:n},u),{},{components:t})):o.createElement(f,a({ref:n},u))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,a=new Array(r);a[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=t[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},603:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var o=t(7462),i=t(3366),r=(t(7294),t(3905)),a=["components"],l={sidebar_position:10},s="Coroutines",c={unversionedId:"coroutines/coroutines",id:"coroutines/coroutines",isDocsHomePage:!1,title:"Coroutines",description:"Kotlin coroutines provide two advantages to Klogging.",source:"@site/docs/coroutines/coroutines.md",sourceDirName:"coroutines",slug:"/coroutines/coroutines",permalink:"/docs/coroutines/coroutines",version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Sending log events",permalink:"/docs/logging/sending-logs"},next:{title:"Using Klogging directly",permalink:"/docs/java/klogging-from-java"}},u=[{value:"Contextual information management",id:"contextual-information-management",children:[]},{value:"Asynchronous dispatching of log events",id:"asynchronous-dispatching-of-log-events",children:[]}],g={toc:u};function p(e){var n=e.components,l=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},g,l,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"coroutines"},"Coroutines"),(0,r.kt)("p",null,"Kotlin coroutines provide two advantages to Klogging."),(0,r.kt)("h2",{id:"contextual-information-management"},"Contextual information management"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/context/LogContext.kt"},(0,r.kt)("inlineCode",{parentName:"a"},"LogContext")),"\nclass is designed to hold a map of contextual information in a\ncoroutine context. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'suspend fun complexLogic(input: EssentialStuff) = coroutineScope {\n    launch(logContext("runId" to input.runId)) {\n        logger.info { "Starting logic" }\n\n        // Do stuff, potentially logging events\n\n        logger.info { "Finished logic" }\n    }\n}\n')),(0,r.kt)("p",null,"The log events sent by any code within the scope of the launched\ncoroutine will contain a field called ",(0,r.kt)("inlineCode",{parentName:"p"},"runId")," with the value of\n",(0,r.kt)("inlineCode",{parentName:"p"},"input.runId")," for that particular run."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Example of two log events with the same value of runId in Seq",src:t(2402).Z})),(0,r.kt)("p",null,"Coroutine context information is kept for the duration of the current coroutine scope\nand is automatically removed at the end of that scope. Context information is also\nautomatically moved between scopes as required."),(0,r.kt)("p",null,"This is easier to use and more flexible than Mapped Diagnostic Context (MDC) in Logback\nand ThreadContext in Log4J. Those contexts require callers to put remove items when\nfinished and to ensure items are moved between threads."),(0,r.kt)("h2",{id:"asynchronous-dispatching-of-log-events"},"Asynchronous dispatching of log events"),(0,r.kt)("p",null,"Coroutines provide a simple way to asynchronously dispatch log events to different\nsinks. Klogging launches new coroutines in a number of places:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For dispatching log events to sinks."),(0,r.kt)("li",{parentName:"ul"},"For receiving log events from event and sink channels."),(0,r.kt)("li",{parentName:"ul"},"For sending batches of log events to network destinations.")),(0,r.kt)("p",null,"In addition, Klogging ",(0,r.kt)("a",{parentName:"p",href:"../concepts/klogging-process"},"uses channels")," to process events."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"All log events are ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/internal/Emitter.kt#L59"},"sent into the events channel"),"\nin a coroutine.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"They are read in a different coroutine and dispatched to each matching sink by ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/internal/Sink.kt#L70"},"sending\nit into each sink"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Events are ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/sending/Batching.kt#L49"},"read from sink channels in batches"),"\nin different coroutines."))))}p.isMDXComponent=!0},2402:function(e,n,t){n.Z=t.p+"assets/images/seq-log-events-same-runId-83956a942f032b94febf2057ee7a686a.png"}}]);