"use strict";(self.webpackChunkklogging=self.webpackChunkklogging||[]).push([[397],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(n),u=o,d=m["".concat(s,".").concat(u)]||m[u]||g[u]||i;return n?r.createElement(d,a(a({ref:t},p),{},{components:n})):r.createElement(d,a({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3521:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var r=n(7462),o=n(3366),i=(n(7294),n(3905)),a=["components"],l={sidebar_position:5},s="Klogging internal process (under development)",c={unversionedId:"internals/klogging-process",id:"internals/klogging-process",isDocsHomePage:!1,title:"Klogging internal process (under development)",description:"This process is not yet implemented: I am re-writing the internals of Klogging to make the best use of coroutines",source:"@site/docs/internals/klogging-process.md",sourceDirName:"internals",slug:"/internals/klogging-process",permalink:"/docs/internals/klogging-process",version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Sinks",permalink:"/docs/concepts/sinks"},next:{title:"Environment variables",permalink:"/docs/internals/environment-variables"}},p=[{value:"Log event order",id:"log-event-order",children:[]}],g={toc:p};function m(e){var t=e.components,l=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},g,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"klogging-internal-process-under-development"},"Klogging internal process (under development)"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This process is not yet implemented: I am re-writing the internals of Klogging to make the best use of coroutines\nand to provide predictable ordering of log events to some destinations."))),(0,i.kt)("p",null,"Klogging processes log events through Kotlin ",(0,i.kt)("a",{parentName:"p",href:"https://kotlinlang.org/docs/channels.html"},"coroutine channels"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Klogging process diagram",src:n(6615).Z})),(0,i.kt)("p",null,"Notes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Filter"),": only construct and emit a log event if ",(0,i.kt)("a",{parentName:"p",href:"level-checking"},"specified by Klogger configuration"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Emit"),": send a log event into the events channel.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Dispatch"),": determine which sinks are to receive a log event and send them into those sink channels.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Render"),": convert a log event into a representation suitable for a sink.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Send"),": deliver a rendered log event to a destination.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../concepts/log-events"},"LogEvent"),"s are constructed as close as possible to the code they describe.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../loggers/defining-loggers"},"Klogger")," instances have ",(0,i.kt)("inlineCode",{parentName:"p"},"suspend")," functions for emitting log events.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../loggers/defining-loggers"},"NoCoLogger")," instances do not have ",(0,i.kt)("inlineCode",{parentName:"p"},"suspend")," functions, and launch coroutines\nto emit events into the events channel.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Each sink has its own channel and processes log events in the order it receives them."))),(0,i.kt)("h2",{id:"log-event-order"},"Log event order"),(0,i.kt)("p",null,"When coroutines are launched, the order in which suspend functions complete is unpredictable.\nKlogging attempts to preserve order as much as it can without sacrificing performance by not launching\nnew coroutines unless necessary."),(0,i.kt)("p",null,"New coroutines are launched in these places:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Creating the loop in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/impl/Logging.kt#L42"},"Logging.kt"),"\n(location may change) that reads from the events channel and calls ",(0,i.kt)("inlineCode",{parentName:"p"},"dispatchEvent"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Emitting log events into the events channel from\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/impl/NoCoLoggerImpl.kt#L41"},"NoCoLoggerImpl.kt"),".\nA new coroutine is launched for every log event.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Creating the loop in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/klogging/klogging/blob/main/src/commonMain/kotlin/io/klogging/internal/Sink.kt#41"},"Sink.kt"),"\nthat reads from the channel for each sink."))),(0,i.kt)("p",null,"Sinks may launch coroutines in order to send log events to their destinations."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Sinks that send events to the console or to the filesystem do not launch coroutines because they are expected to\nwork without significant delay. They will preserve the order that log events were emitted.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Sinks that send events to remote destinations will typically launch multiple coroutines to allow for delays\nin delivering events. The order in which those destinations (e.g. log aggregation services) receive log events\nis not guaranteed. Log aggregators are expected to use timestamps to order log events."))))}m.isMDXComponent=!0},6615:function(e,t,n){t.Z=n.p+"assets/images/klogging-process-03a26314c831a421268e1ca4e4b73cf9.svg"}}]);